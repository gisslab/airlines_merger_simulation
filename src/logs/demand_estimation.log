----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/gisellelab/Work/airlines_merger_simulation/src/logs/demand_estimation.log
  log type:  text
 opened on:  17 Sep 2025, 14:35:00

. 
. // ---------------------- PARAMETERS -------------------------------------------
. global YEARS   "2005/2019"

. global QUARTERS "1 2 3 4"

. global TYPE     "Market"   // DB1B “Market”

. 
. {
.     di as yellow "--------------------------------------------------------------------------------------------------"
--------------------------------------------------------------------------------------------------
.     di as yellow "----------------------------------- Running demand_estimation.do ---------------------------------"
----------------------------------- Running demand_estimation.do ---------------------------------
.     di as yellow "--------------------------------------------------------------------------------------------------"
--------------------------------------------------------------------------------------------------
. }

. cap mkdir "$OUT"

. 
. di as yellow "    Demand estimation started for years: $YEARS, quarters: $QUARTERS, type: $TYPE"
    Demand estimation started for years: 2005/2019, quarters: 1 2 3 4, type: Market

. 
. * Source data from previous step
. local source_csv "${PROC_DATA}airline_data.csv"

. di as yellow "    Source data: `source_csv'"
    Source data: ./data/processed/combined/airline_data.csv

. 
. // *----------------------------------------------------------*
. // * COLUMN MAPPING                                           *
. // * Column mapping in airline_data.csv (matching processing_data.do output)
. // * Set up configuration for column mapping below
. // *----------------------------------------------------------*
. 
. * Required identifiers
. local id_prod      "product_id"            // product (itinerary/airline) id - we'll create this

. local id_market    "market_code"                // origin–destination market id (fixed effect)

.                                             // possibles (same meaning) market_airport_city mkt_code mkt_name
. local id_time      "time"                  // time (optional control/cluster)

. local id_carrier   "carrier"               // marketing carrier code 

. local id_group_2     "lcc"                  // definition for LEVEL 2 of the nest e.g. lcc, legacy

. local id_group_1     "carrier_dummy"          // definition for LEVEL 1 of the nest e.g. carrier_dummy(inside vs outside),  (CRE
> ATED LATER)

.                                                 //  if only one nest `id_group_1' leave empty, and fill `id_group_2' with the ne
> st definition                      
. 
. * Demand-side quantities (matching processing_data.do variable names)
. local market_size_var "pop_o_d_geo_mean"      // market size variable (sqrt(orig_pop*dest_pop)), (CREATED LATER)

.             // other options generated are pop_o_d_geo_mean, pop_sum, mean_pop, max_pop 
.                                                 // choose one of these three alternatives if you want a different market size de
> finition
.                                                 // adjust demand scale accordingly, right now set to 10
. local var_fare     "average_fare"          // average ticket price 

. local var_nest     "lns_minus_ln_g lns_minus_ln_h"          // ln(s_jt|h) ln(s_ht|g) for nested logit, s_minus_ln_g (CREATED LAT
> ER)

.                                                 // if 2-level: lns_minus_ln_g lns_minus_ln_h, if single-level: lns_minus_ln_h
. local var_fringe   "fringe_carriers"        // fringe_carriers: number of rival carriers in market 

. 
. * Rival-based instruments (matching processing_data.do variable names)
. local iv_rivaldist   "average_distance_rival" // average distance rival (for IV)

. local iv_rivalpres   "average_presence_rival" // average presence rival (for IV)

. local iv_rivalmkts   "average_num_destinations_rival" // options: average_num_destinations_rival average_num_markets_rival

. local iv_numrivals   "rival_carriers"

. 
. // *----------------------------------------------------------*
. // * LOCALS FOR ESTIMATION                                    *
. // * CONFIG locals for estimation below (X, Z, nests, FE etc.)
. // *----------------------------------------------------------*
. 
. di as yellow "    ---------  Setting up locals for estimation ---------"
    ---------  Setting up locals for estimation ---------

. 
. * Core X’s (match Table C2): price first so α is easy to spot, 
. local X_exog  "share_nonstop dist_k dist_k2 lnum_fringe"

. local X_core  "`var_fare' `X_exog'"

. 
. * Instruments (rival shifters)
. local Z_price  "`iv_rivaldist' `iv_rivalmkts'"

. local Z_core  "`Z_price' `iv_numrivals'"

. local Z_nest2 "`iv_numrivals'_nest2"

. 
. * FE and clusters
. local FE      "`id_market'"              // OD fixed effects, plus time maybe `id_time'

. local CL      "`id_market'"       // cluster by OD (you can switch) O-D clusters with those FE cause collinearity when IVs.

. 
. local clustering_config "vce(robust)"  // leave empty or vce(robust) for robust, or add "cluster(`CL')" or "vce(cluster <cluster
> ing_group>)" for clustered SEs

. 
. scalar scale_share = 10  // scale factor for shares, if market size is pop_o_d_geo_mean (sqrt(orig_pop*dest_pop))

. 
. scalar min_share = 10^-7  // minimum share to keep an observation (to avoid -inf in log)

. 
. local est_models "OLS IV NL_OLS IV_NL" // list of models estimates to report

. 
. // *----------------------------------------------------------*
. // * LOAD & PREP                                              *
. // *----------------------------------------------------------*
. import delimited using "`source_csv'",  clear
(encoding automatically selected: ISO-8859-1)
(38 vars, 1,677,867 obs)

. 
. * Make sure key variables are in proper format
. tostring `id_market' `id_carrier' `id_time', replace
market_code already string; no replace
carrier already string; no replace
time already string; no replace

. 
. * Create product ID (combination of market, carrier, time)
. egen long product_id = group(`id_market' `id_carrier' `id_time')
(29 missing values generated)

. 
. * Create proper market shares first (as in processing_data.do commented code)
. di as yellow "    ---------  Creating shares and log differences ---------"
    ---------  Creating shares and log differences ---------

. 
. // * Share definitions:
. * s_jt     : product share s_j
. * s_j_h    : conditional share s_{j|h}
. * s_h_g    : conditional share s_{h|g}
. * s_g      : group share (sum of s_j over all products in group g)
. * s_h      : sub-group share (sum of s_j over all products in sub-group h)
. * price    : product price (your `var_fare')
. * sigma1   : coefficient on ln(s_{h|g}) from your 2-level NL regression
. * sigma2   : coefficient on ln(s_{j|h}) from your 2-level NL regression
. * alpha_nl : the regression coefficient on price
. 
. tab year quarter, missing

           |                   quarter
      year |         1          2          3          4 |     Total
-----------+--------------------------------------------+----------
      2005 |    31,337     34,277     33,865     32,868 |   132,347 
      2006 |    31,741     34,752     34,667     34,449 |   135,609 
      2007 |    32,884     34,798     33,903     32,691 |   134,276 
      2008 |    29,852     33,813     32,841     31,377 |   127,883 
      2009 |    29,442     32,528     32,294     31,218 |   125,482 
      2010 |    29,986     30,659     30,853     29,502 |   121,000 
      2011 |    27,443     30,542     30,474     29,290 |   117,749 
      2012 |    24,087     25,997     25,747     25,078 |   100,909 
      2013 |    23,765     26,621     26,468     25,874 |   102,728 
      2014 |    25,095     27,208     26,861     25,682 |   104,846 
      2015 |    23,730     26,374     21,794     21,263 |    93,161 
      2016 |    20,098     22,739     22,946     22,231 |    88,014 
      2017 |    21,235     23,200     23,373     23,343 |    91,151 
      2018 |    21,948     25,193     25,301     25,077 |    97,519 
      2019 |    23,694     27,358     27,448     26,693 |   105,193 
-----------+--------------------------------------------+----------
     Total |   396,337    436,059    428,835    416,636 | 1,677,867 

. 
. // market definition: geometric mean 
. cap gen double pop_o_d_geo_mean = sqrt(origin_pop * dest_pop)

. 
. // alternative market size definitions
. cap gen double pop_sum = origin_pop + dest_pop

. cap gen double mean_pop = (origin_pop + dest_pop)/2

. cap gen double max_pop = max(origin_pop, dest_pop)

. 
. * Market-level total passengers (sum over products in each market-time), can be used for an alternative market definition
. bys `id_market' `id_time': egen pax_market = total(total_passengers)

. 
. // * Market shares for logit
. gen s_jt = (scale_share * total_passengers)/`market_size_var' // mkt size is sqrt(orig_pop*dest_pop), so share is scaled by 10
(40,951 missing values generated)

. bys `id_market' `id_time': egen s_inside_t = total(s_jt)

. gen s_0t = 1 - s_inside_t

. replace s_0t = .0000001 if s_0t<=0  // small epsilon to avoid -inf
(0 real changes made)

. 
. sum s_jt s_0t s_inside_t

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        s_jt |  1,636,916    .0013417    .0058076   6.12e-07   .4734702
        s_0t |  1,677,867    .9920027     .015648   .3364701          1
  s_inside_t |  1,677,867    .0079973     .015648          0   .6635299

. 
. //     Variable |        Obs        Mean    Std. dev.       Min        Max
. // -------------+---------------------------------------------------------
. //         s_jt |  1,636,916    .0013417    .0058076   6.12e-07   .4734702
. //         s_0t |  1,677,867    .9920027     .015648   .3364701          1
. //   s_inside_t |  1,677,867    .0079973     .015648          0   .6635299
. 
. 
. * log(S_t): create from `market_size' (which is sqrt(orig_pop*dest_pop))
. gen logS = ln(`market_size_var') // not needed for estimation
(40,951 missing values generated)

. 
. * Dependent variable for logit
. gen lns_minus_lno = ln(s_jt) - ln(s_0t)
(40,951 missing values generated)

. 
. // * Nest definition: Group by  nest
. 
. // Possible nests definitions below:
. // - by inside goods (inside nest vs outside)
. gen carrier_dummy = 1

. // - by airline type (major vs. non-major), though is has time variation
. // - by carrier type (legacy)
. // - by low cost carrier (LCC) vs. legacy: 
. // - by non stop vs. connecting :
. gen nonstop_route = (share_nonstop >= 0.5)  // or some threshold

. // - by hub vs. non-hub:
. gen hub_route = (origin_hub == 1 | destination_hub == 1) 

. 
. // if group_2 is empty and group_1 is not, use group_1 only swap
. if "`id_group_2'" == "" & "`id_group_1'" != "" {
.     di as yellow "    Note: nest 2 var `id_group_2' is empty, using only `id_group_1' for nest definition"
.     local id_group_2 "`id_group_1'"
.     local id_group_1 ""
. }

. 
. // * Create definition var with defined `var_group'
. * This creates meaningful nests where multiple carriers belong to the same nest
. egen nest_h = group(`id_market' `id_time' `id_group_2')  // or legacy, or lcc

. bys nest_h: egen s_h = total(s_jt)                   // nest share (incl current j)

. gen s_j_h = s_j / s_h             // Share within sub-nest h
(40,951 missing values generated)

. 
. // replace s_h = min(max(s_h, .000001), .999999) // avoid 0 or 1
. 
. if "`id_group_1'" != "" {
.     egen nest_g = group(`id_market' `id_time' `id_group_1')  // or legacy, or lcc
.     bys nest_g: egen s_g = total(s_jt)                   // nest share (incl current j)
.     gen s_j_g = s_jt / s_g             // Share within sub-nest g
(40,951 missing values generated)
.     local nest_lv1 "lns_minus_ln_jg"
. } 

. else {
.     di as yellow "    Note: using single-level nesting with `id_group_2' only"
.     local nest_lv1 "lns_minus_ln_h"
.     gen s_g = s_h  // if only one nest, then s_g =
. }

. // Define shares for nested logit structure
. gen s_h_g = s_h / s_g             // Share of sub-nest h within top nest g
(40,951 missing values generated)

. 
. * Nested-logit transformed nest shares
. gen lns_minus_ln_h = ln(s_j_h)           // Share within sub-nest h// same as ln(s_jt) - ln(s_h)
(40,951 missing values generated)

. gen lns_minus_ln_g = ln(s_h_g)           // Share of sub-nest h within top nest g// same as ln(s_h) - ln(s_g) //! it's zero if s
> ingle-level nest
(40,951 missing values generated)

. gen lns_minus_ln_jg = ln(s_j_g)           // Share of top nest g within overall nest j// same as ln(s_g) - ln(s_j)
(40,951 missing values generated)

. 
. sum lns_minus_lno lns_minus_ln_h lns_minus_ln_g

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
lns_minus_~o |  1,636,916    -8.05655    1.858922  -14.27474   .0842574
lns_minus_~h |  1,636,916    -2.18692    1.843083  -11.10121          0
lns_minus~_g |  1,636,916   -.5481164    .8152674  -9.979893          0

. 
. 
end of do-file

. do /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T/StataRun1758137809965.do

. // Final project
. // Date : 9-15-2025
. // Reference for nested logit :
. //  - Train, Kenneth E. (2009). Discrete Choice Methods with Simulation, 2nd ed.
. //    Cambridge University Press — Chapter 4 “Nested Logit”.
. //  - Helpful note for share derivatives/elasticities:
. //     Mansley, R., N. Miller, C. Ryan, and M. Weinberg (2019/2024),
. //     “Notes on the Nested Logit Demand Model.” (short technical memo)
. 
. // Install as: 
. // net from http://www.bjornerstedt.org/stata/mergersim
. // net install mergersim, replace
. 
. *global mainpath "/Users/kkang57/Dropbox/Teaching/MS-IO/final_project"
. 
. cd "/Users/gisellelab/Work/airlines_merger_simulation"   // <-- adjust this, then run the do-file , My path is 
/Users/gisellelab/Work/airlines_merger_simulation

. 
. global PROC_DATA    "./data/processed/combined/"                // processed data

. global CODE_DIR      "./src/"                         

. global OUT      "./src/output/"              // output folder          // source code directory

. // global mainpath "/Users/karamkang/Library/CloudStorage/Dropbox/Teaching/MS-IO/final_project"
. 
. // log using "$mainpath/analysis/prelim_analysis.log", replace
. cap log using "${CODE_DIR}/logs/prelim_analysis_merger.log", replace

. 
. clear

. // use "$mainpath/data/airline_data_main.dta"
. use "$PROC_DATA/airline_data_main.dta", clear

. 
. *---------------------------
. * 1. preparing the data
. *---------------------------
. 
. * focus on a 5% sub-sample of the data (for computational purposes)
. //! this way of randomizing is creating bias towards smaller markets (less observations per market)
. // set seed 12345
. // gen random_uniform = runiform()
. // bys market_code: egen rr = mean(random_uniform)
. // quietly sum rr, detail
. // keep if rr<r(p5)
. 
. preserve

. bys market_code: keep if _n == 1  // Keep one obs per market
(1,669,808 observations deleted)

. sample 100                          // Sample 20% of markets

. keep market_code                  // Keep only market identifier

. tempfile sampled_markets

. save `sampled_markets'
file /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T//S_17493.000002 saved as .dta format

. restore

. merge m:1 market_code using `sampled_markets', keep(match) nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         1,677,867  
    -----------------------------------------

. 
. * define markets: time-destination-origin
. encode carrier, gen(firmid)

. egen marketid = group(year quarter market_code)

. egen marketid2 = group(market_code)

. 
. * market size: alternatives
. gen pop_o_d_geo_mean = sqrt(origin_pop * dest_pop)      // geometric mean 
(40,951 missing values generated)

. gen pop_sum = origin_pop + dest_pop                     // sum
(40,951 missing values generated)

. gen mean_pop = (origin_pop + dest_pop)/2        // average
(40,951 missing values generated)

. gen max_pop = max(origin_pop, dest_pop)         // maximum
(568 missing values generated)

. 
. * declare market size
. gen msize = pop_o_d_geo_mean/10
(40,951 missing values generated)

. gen mshare = total_passengers/msize
(40,951 missing values generated)

. sum mshare

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mshare |  1,636,916    .0013417    .0058076   6.12e-07   .4734702

. 
. * nesting groups: alternatives
. gen inside = 1

. gen nonstop_route = (share_nonstop > 0)  // by non stop vs. connecting

. 
. * declare nesting groups
. gen nest1 = inside // ! comment

. gen nest2 = 3 // ! comment

. // replace nest2 = 1 if legacy == 1 // ! comment
. replace nest2 = 2 if lcc == 1
(338,329 real changes made)

. 
. * market/product attributes
. gen dist_k   = average_distance/1000    // distances in thousands

. gen dist_k2  = dist_k^2                                 // distances in thousands, squared

. gen lnum_fringe = ln(1 + fringe_carriers)

. 
. * declare market/product attributes to control for
. local x_exog "share_nonstop dist_k dist_k2 lnum_fringe"

. 
. * instruments for market share
. bys marketid nest1 nest2: egen rival_carriers_nest = sum(inside)

. replace rival_carriers_nest = rival_carriers_nest-1 // number of rivals within the nest
(1,677,867 real changes made)

. 
. * declare instruments for price and market share
. local inst "average_distance_rival average_num_destinations_rival rival_carriers_nest"

. 
. * set the panel data: product x markets
. xtset firmid marketid

Panel variable: firmid (unbalanced)
 Time variable: marketid, 1 to 309105, but with gaps
         Delta: 1 unit

. 
. *-------------------------------------
. * 2. performing a merger simulation
. *-------------------------------------
. 
. * step 1: initializing the merger simulation settings
. mergersim init, nests(nest1 nest2) price(average_fare) quantity(total_passengers) marketsize(msize) firm(firmid)
--------------------------------------------------------------------------------
MERGERSIM: Merger Simulation Program
Version 1.0, Revision: 218 
--------------------------------------------------------------------------------
Unit demand two-level nested logit

                  Depvar              Price               Group shares
                  --------------------------------------------------------------
                  M_ls                average_fare        M_lsjh M_lshg
--------------------------------------------------------------------------------
Variables generated: M_ls M_lsjh M_lshg
--------------------------------------------------------------------------------

. 
. sum M_ls M_lsjh M_lshg

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        M_ls |  1,636,916    -8.05655    1.858922  -14.27474   .0842575
      M_lsjh |  1,677,867   -2.182815    1.841456  -11.10121          0
      M_lshg |  1,677,867    -.550246    .8200794  -9.979893          0

. 
. 
end of do-file

. do /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T/StataRun1758139109685.do

. // Final project
. // Date : 9-15-2025
. // Reference for nested logit :
. //  - Train, Kenneth E. (2009). Discrete Choice Methods with Simulation, 2nd ed.
. //    Cambridge University Press — Chapter 4 “Nested Logit”.
. //  - Helpful note for share derivatives/elasticities:
. //     Mansley, R., N. Miller, C. Ryan, and M. Weinberg (2019/2024),
. //     “Notes on the Nested Logit Demand Model.” (short technical memo)
. 
. // Install as: 
. // net from http://www.bjornerstedt.org/stata/mergersim
. // net install mergersim, replace
. 
. *global mainpath "/Users/kkang57/Dropbox/Teaching/MS-IO/final_project"
. 
. cd "/Users/gisellelab/Work/airlines_merger_simulation"   // <-- adjust this, then run the do-file , My path is 
/Users/gisellelab/Work/airlines_merger_simulation

. 
. global PROC_DATA    "./data/processed/combined/"                // processed data

. global CODE_DIR      "./src/"                         

. global OUT      "./src/output/"              // output folder          // source code directory

. // global mainpath "/Users/karamkang/Library/CloudStorage/Dropbox/Teaching/MS-IO/final_project"
. 
. // log using "$mainpath/analysis/prelim_analysis.log", replace
. cap log using "${CODE_DIR}/logs/prelim_analysis_merger.log", replace

. 
. clear

. // use "$mainpath/data/airline_data_main.dta"
. use "$PROC_DATA/airline_data_main.dta", clear

. 
. *---------------------------
. * 1. preparing the data
. *---------------------------
. 
. * focus on a 5% sub-sample of the data (for computational purposes)
. //! this way of randomizing is creating bias towards smaller markets (less observations per market)
. // set seed 12345
. // gen random_uniform = runiform()
. // bys market_code: egen rr = mean(random_uniform)
. // quietly sum rr, detail
. // keep if rr<r(p5)
. 
. // * new addition: sample 15% of markets, sample one market at a time
. preserve

. bys market_code: keep if _n == 1  // Keep one obs per market
(1,669,808 observations deleted)

. sample 15                          // Sample 15% of markets
(6,850 observations deleted)

. keep market_code                  // Keep only market identifier

. tempfile sampled_markets

. save `sampled_markets'
file /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T//S_17493.000002 saved as .dta format

. restore

. merge m:1 market_code using `sampled_markets', keep(match) nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           250,757  
    -----------------------------------------

. 
. * define markets: time-destination-origin
. encode carrier, gen(firmid)

. egen marketid = group(year quarter market_code)

. egen marketid2 = group(market_code)

. 
. * market size: alternatives
. gen pop_o_d_geo_mean = sqrt(origin_pop * dest_pop)      // geometric mean 
(5,828 missing values generated)

. gen pop_sum = origin_pop + dest_pop                     // sum
(5,828 missing values generated)

. gen mean_pop = (origin_pop + dest_pop)/2        // average
(5,828 missing values generated)

. gen max_pop = max(origin_pop, dest_pop)         // maximum

. 
. * declare market size
. gen msize = pop_o_d_geo_mean/10
(5,828 missing values generated)

. gen mshare = total_passengers/msize
(5,828 missing values generated)

. sum mshare

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mshare |    244,929    .0012733    .0042604   6.12e-07   .2529275

. 
. * nesting groups: alternatives
. gen inside = 1

. gen nonstop_route = (share_nonstop > 0)  // by non stop vs. connecting

. 
. * declare nesting groups
. gen nest1 = inside // ! comment

. gen nest2 = 3 // ! comment

. // replace nest2 = 1 if legacy == 1 // ! comment
. replace nest2 = 2 if lcc == 1
(49,970 real changes made)

. 
. * market/product attributes
. gen dist_k   = average_distance/1000    // distances in thousands

. gen dist_k2  = dist_k^2                                 // distances in thousands, squared

. gen lnum_fringe = ln(1 + fringe_carriers)

. 
. * declare market/product attributes to control for
. local x_exog "share_nonstop dist_k dist_k2 lnum_fringe"

. 
. * instruments for market share
. bys marketid nest1 nest2: egen rival_carriers_nest = sum(inside)

. replace rival_carriers_nest = rival_carriers_nest-1 // number of rivals within the nest
(250,757 real changes made)

. 
. * new addition: create additional IV for upper level nesting (rival carriers in market)
. gen rival_carriers_market = rival_carriers

. 
. * declare instruments for price and market share
. local inst "average_distance_rival average_num_destinations_rival rival_carriers_nest rival_carriers_market"

. 
. // * new addition: filter small market shares to avoid numerical issues (BEFORE mergersim init)
. scalar min_share_filter = 10^-7

. keep if mshare > min_share_filter
(0 observations deleted)

. 
. // * new addition: eliminate singleton markets after share filtering
. bys marketid: keep if _N > 1
(0 observations deleted)

. 
. * set the panel data: product x markets
. xtset firmid marketid

Panel variable: firmid (unbalanced)
 Time variable: marketid, 1 to 46376, but with gaps
         Delta: 1 unit

. 
. *-------------------------------------
. * 2. performing a merger simulation
. *-------------------------------------
. 
. * step 1: initializing the merger simulation settings
. mergersim init, nests(nest1 nest2) price(average_fare) quantity(total_passengers) marketsize(msize) firm(firmid)
--------------------------------------------------------------------------------
MERGERSIM: Merger Simulation Program
Version 1.0, Revision: 218 
--------------------------------------------------------------------------------
Unit demand two-level nested logit

                  Depvar              Price               Group shares
                  --------------------------------------------------------------
                  M_ls                average_fare        M_lsjh M_lshg
--------------------------------------------------------------------------------
Variables generated: M_ls M_lsjh M_lshg
--------------------------------------------------------------------------------

. 
. sum M_ls M_lsjh M_lshg // exploring that log nests are the same than in the demand estimation . do> YES

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        M_ls |    244,929   -8.056438    1.843879  -14.26687  -1.015037
      M_lsjh |    250,757   -2.191233    1.850301  -10.77996          0
      M_lshg |    250,757   -.5364782    .8150867  -9.377717          0

. 
. * step 2: nested logit demand model estimation
. ivreghdfe M_ls (average_fare M_lsjh M_lshg = average_distance_rival average_num_destinations_rival rival_carriers_nest rival_car
> riers_market) share_nonstop dist_k dist_k2 lnum_fringe, absorb(marketid2) cluster(marketid2)
(MWFE estimator converged in 1 iterations)

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on marketid2

Number of clusters (marketid2) =   1178               Number of obs =   244929
                                                      F(  7,  1177) = 36843.24
                                                      Prob > F      =   0.0000
Total (centered) SS     =  754059.3713                Centered R2   =   0.9658
Total (uncentered) SS   =  754059.3713                Uncentered R2 =   0.9658
Residual SS             =  25823.72855                Root MSE      =    .3247

-------------------------------------------------------------------------------
              |               Robust
         M_ls | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
 average_fare |  -.0031314   .0008524    -3.67   0.000    -.0048039   -.0014589
       M_lsjh |   .8956042   .0185731    48.22   0.000     .8591641    .9320443
       M_lshg |   .9336248   .0390787    23.89   0.000     .8569531    1.010297
share_nonstop |    .254996   .0422161     6.04   0.000     .1721687    .3378233
       dist_k |  -.2586193   .1235393    -2.09   0.037    -.5010012   -.0162374
      dist_k2 |   .0378976   .0077146     4.91   0.000     .0227618    .0530335
  lnum_fringe |  -.0310947   .0089595    -3.47   0.001    -.0486731   -.0135163
-------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):             57.768
                                                   Chi-sq(2) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):              120.617
                         (Kleibergen-Paap rk Wald F statistic):         16.461
Stock-Yogo weak ID test critical values:                       <not available>
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):         5.458
                                                   Chi-sq(1) P-val =    0.0195
------------------------------------------------------------------------------
Instrumented:         average_fare M_lsjh M_lshg
Included instruments: share_nonstop dist_k dist_k2 lnum_fringe
Excluded instruments: average_distance_rival average_num_destinations_rival
                      rival_carriers_nest rival_carriers_market
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
   marketid2 |      1178        1178           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. * step 3: analyzing premerger market conditions
. mergersim market if year == 2013
---------------------------------------------------------------------------------
Supply: Bertrand competition
Demand: Unit demand two-level nested logit
--------------------------------------------------------------------------------
Demand estimate
ivreghdfe M_ls (average_fare M_lsjh M_lshg = average_distance_rival average_num_destinations_rival rival_carriers_nest rival_carri
> ers_market) share_nonstop dist_k dist_k2 lnum_fringe, absorb(marketid2) cluster(marketid2)
Dependent variable: M_ls
--------------------------------------------------------------------------------

Parameters

alpha = -0.003
sigma1 = 0.896 
sigma2 = 0.934 
----------------------------------------------------------------
Own- and Cross-Price Elasticities:  unweighted market averages

    Variable |      Mean        SD       Min       Max
-------------+----------------------------------------
       M_ejj |    -6.350     2.837   -69.789    -0.177
       M_ejk |     0.718     1.606    -8.815    12.285
       M_ejl |     1.970     2.325     0.000    20.138
       M_ejm |     0.001     0.002     0.000     0.073
------------------------------------------------------
Observations: 15502
----------------------------------------------------------------
ERROR: sigma 2 should be smaller than sigma 1.
sigma1: .895604179641921
sigma2: .9336247989557572

Pre-merger Market Conditions 
Unweighted averages by firmid

---------------------------------------------------------------------------------
              firmid |       average_fare      Marginal costs   Pre-merger Lerner
---------------------+-----------------------------------------------------------
                  3M |            150.349             118.079               0.215
                  AA |            244.075             203.483               0.179
                  AM |            384.396             351.055               0.087
                  AS |            307.880             263.614               0.216
                  AY |            137.103             103.757               0.275
                  AZ |            240.248             206.909               0.139
                  B6 |            231.044             200.002               0.157
                  BA |            233.520             200.165               0.353
                  CM |            475.358             441.991               0.070
                  DL |            244.038             194.073               0.216
                  F9 |            181.339             149.127               0.201
                  FJ |            973.003             939.645               0.136
                  FL |            187.338             152.164               0.207
                  G4 |             93.864             -16.162               1.289
                  HA |            320.138             237.119               0.475
                  IB |            165.987             132.632               0.285
                  JL |            288.297             254.929               0.158
                  KL |            650.979             617.639               0.051
                  LY |           1079.266            1045.927               0.047
                  NH |           1704.843            1671.504               0.023
                  NK |            131.129              83.882               0.377
                  NZ |            239.786             206.444               0.141
                  QF |            497.744             464.405               0.216
                  QR |            436.835             403.496               0.081
                  S5 |            183.882             150.541               0.181
                  SA |           1299.185            1265.846               0.026
                  SY |            186.679             145.248               0.239
                  TA |            231.931             198.589               0.144
                  UA |            247.985             206.319               0.175
                  US |            256.682             214.006               0.179
                  VA |            373.770             340.428               0.089
                  VX |            234.042             199.401               0.168
                  WN |            204.735             167.639               0.201
                  WP |            124.448              91.107               0.268
                  YV |            102.570              80.673               0.222
---------------------------------------------------------------------------------
Variables generated: M_costs M_delta 
---------------------------------------------------------------------------------

. 
. * step 4: simulating the merger effects
. *         consider a merger between AA (buyer) and US (seller)
. *         note: AA and US merger approved in Dec 2013
. mergersim simulate if year == 2014, seller(61) buyer(6) detail
Simulation did not converge.
Error: 

---------------------------------------------------------------------------------
Merger Simulation

                                            Simulation method: Newton
                        Buyer     Seller    Periods/markets: 3009
Firm                    6         61        Average number of iterations: 27.21 
                                            Max number of iterations: 1000  
Marginal cost savings                       Max price change in last it: 6.2e-06  
---------------------------------------------------------------------------------

Prices
Unweighted averages by firmid

---------------------------------------------------------------------------------
              firmid |         Pre-merger         Post-merger     Relative change
---------------------+-----------------------------------------------------------
                  3M |            189.961             189.961               0.000
                  AA |            252.814             252.814              -0.000
                  AB |            423.873             423.873              -0.000
                  AS |            285.471             285.471              -0.000
                  AY |            253.924             253.924               0.000
                  B6 |            236.609             236.609              -0.000
                  BA |            251.116             251.116              -0.000
                  DL |            251.683             251.683              -0.000
                  EI |           1389.470            1389.470               0.000
                  F9 |            180.209             180.209               0.000
                  FL |            188.205             188.205              -0.000
                  G4 |             94.321              94.321              -0.000
                  HA |            389.243             389.243               0.000
                  IB |             64.695              64.695              -0.000
                  JJ |            338.274             338.274               0.000
                  LY |           1529.509            1529.509              -0.000
                  NH |            156.406             156.406               0.000
                  NK |            133.551             133.551              -0.000
                  NZ |           1004.365            1004.365               0.000
                  QF |            705.950             705.950              -0.000
                  QR |            238.904             238.904               0.000
                  SA |            292.807             292.807              -0.000
                  SY |            222.385             222.385              -0.000
                  UA |            253.133             253.133               0.000
                  US |            249.855             249.855               0.000
                  VX |            224.125             224.125              -0.000
                  WN |            206.810             206.810               0.000
                  YV |            110.470             110.470               0.000
---------------------------------------------------------------------------------
Variables generated: M_price2 M_quantity2 M_price_ch (Other M_ variables dropped)
---------------------------------------------------------------------------------

Market shares by quantity
--Break--
r(1);

end of do-file

--Break--
r(1);

. do /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T/StataRun1758139720401.do

. // Final project
. // Date : 9-15-2025
. // Reference for nested logit :
. //  - Train, Kenneth E. (2009). Discrete Choice Methods with Simulation, 2nd ed.
. //    Cambridge University Press — Chapter 4 “Nested Logit”.
. //  - Helpful note for share derivatives/elasticities:
. //     Mansley, R., N. Miller, C. Ryan, and M. Weinberg (2019/2024),
. //     “Notes on the Nested Logit Demand Model.” (short technical memo)
. 
. // Install as: 
. // net from http://www.bjornerstedt.org/stata/mergersim
. // net install mergersim, replace
. 
. *global mainpath "/Users/kkang57/Dropbox/Teaching/MS-IO/final_project"
. 
. cd "/Users/gisellelab/Work/airlines_merger_simulation"   // <-- adjust this, then run the do-file , My path is 
/Users/gisellelab/Work/airlines_merger_simulation

. 
. global PROC_DATA    "./data/processed/combined/"                // processed data

. global CODE_DIR      "./src/"                         

. global OUT      "./src/output/"              // output folder          // source code directory

. // global mainpath "/Users/karamkang/Library/CloudStorage/Dropbox/Teaching/MS-IO/final_project"
. 
. // log using "$mainpath/analysis/prelim_analysis.log", replace
. cap log using "${CODE_DIR}/logs/prelim_analysis_merger.log", replace

. 
. clear

. // use "$mainpath/data/airline_data_main.dta"
. use "$PROC_DATA/airline_data_main.dta", clear

. 
. *---------------------------
. * 1. preparing the data
. *---------------------------
. 
. // * Checking that legacy and lcc carriers have no overlap
. preserve

. bys carrier: keep if _n==1
(1,677,732 observations deleted)

. list carrier legacy lcc if !missing(legacy) | !missing(lcc)

     +------------------------+
     | carrier   legacy   lcc |
     |------------------------|
  1. |                0     0 |
  2. |      2F        0     0 |
  3. |      3E        0     0 |
  4. |      3M        0     0 |
  5. |      4B        0     0 |
     |------------------------|
  6. |      4M        0     0 |
  7. |      7H        0     0 |
  8. |      9E        0     0 |
  9. |      9K        0     0 |
 10. |      9L        0     0 |
     |------------------------|
 11. |      9W        0     0 |
 12. |      9X        0     0 |
 13. |      AA        1     0 |
 14. |      AB        0     0 |
 15. |      AC        0     0 |
     |------------------------|
 16. |      AF        0     0 |
 17. |      AL        0     0 |
 18. |      AM        0     0 |
 19. |      AQ        1     0 |
 20. |      AS        1     0 |
     |------------------------|
 21. |      AT        0     0 |
 22. |      AV        0     0 |
 23. |      AX        0     0 |
 24. |      AY        0     0 |
 25. |      AZ        0     0 |
     |------------------------|
 26. |      B6        0     1 |
 27. |      BA        0     0 |
 28. |      BB        0     0 |
 29. |      BD        0     0 |
 30. |      BR        0     0 |
     |------------------------|
 31. |      BW        0     0 |
 32. |      C5        0     0 |
 33. |      CA        0     0 |
 34. |      CI        0     0 |
 35. |      CL        0     0 |
     |------------------------|
 36. |      CM        0     0 |
 37. |      CO        1     0 |
 38. |      CX        0     0 |
 39. |      DH        0     1 |
 40. |      DL        1     0 |
     |------------------------|
 41. |      E9        0     0 |
 42. |      EI        0     0 |
 43. |      EK        0     0 |
 44. |      ET        0     0 |
 45. |      EV        0     0 |
     |------------------------|
 46. |      EY        0     0 |
 47. |      F8        0     0 |
 48. |      F9        0     1 |
 49. |      FI        0     0 |
 50. |      FJ        0     0 |
     |------------------------|
 51. |      FL        0     0 |
 52. |      G3        0     0 |
 53. |      G4        0     0 |
 54. |      G7        0     0 |
 55. |      GF        0     0 |
     |------------------------|
 56. |      GQ        0     0 |
 57. |      HA        1     0 |
 58. |      HP        0     0 |
 59. |      HQ        0     0 |
 60. |      HU        0     0 |
     |------------------------|
 61. |      IB        0     0 |
 62. |      JJ        0     0 |
 63. |      JK        0     0 |
 64. |      JL        0     0 |
 65. |      JM        0     0 |
     |------------------------|
 66. |      KE        0     0 |
 67. |      KL        0     0 |
 68. |      KS        0     0 |
 69. |      KX        0     0 |
 70. |      L4        0     0 |
     |------------------------|
 71. |      LA        0     0 |
 72. |      LH        0     0 |
 73. |      LO        0     0 |
 74. |      LP        0     0 |
 75. |      LW        0     0 |
     |------------------------|
 76. |      LX        0     0 |
 77. |      LY        0     0 |
 78. |      MA        0     0 |
 79. |      MH        0     0 |
 80. |      MQ        0     0 |
     |------------------------|
 81. |      MU        0     0 |
 82. |      MW        0     0 |
 83. |      MX        0     0 |
 84. |      NH        0     0 |
 85. |      NK        0     1 |
     |------------------------|
 86. |      NN        0     0 |
 87. |      NW        1     0 |
 88. |      NZ        0     0 |
 89. |      OH        0     0 |
 90. |      OK        0     0 |
     |------------------------|
 91. |      OO        0     0 |
 92. |      OS        0     0 |
 93. |      OZ        0     0 |
 94. |      PR        0     0 |
 95. |      QF        0     0 |
     |------------------------|
 96. |      QR        0     0 |
 97. |      QX        0     0 |
 98. |      RD        0     0 |
 99. |      RG        0     0 |
100. |      RJ        0     0 |
     |------------------------|
101. |      RP        0     0 |
102. |      RW        0     0 |
103. |      S5        0     0 |
104. |      SA        0     0 |
105. |      SK        0     0 |
     |------------------------|
106. |      SN        0     0 |
107. |      SQ        0     0 |
108. |      SU        0     0 |
109. |      SX        0     1 |
110. |      SY        0     1 |
     |------------------------|
111. |      TA        0     0 |
112. |      TK        0     0 |
113. |      TN        0     0 |
114. |      TP        0     0 |
115. |      TZ        0     1 |
     |------------------------|
116. |      U5        0     1 |
117. |      UA        1     0 |
118. |      UP        0     0 |
119. |      US        1     0 |
120. |      V2        0     0 |
     |------------------------|
121. |      VA        0     0 |
122. |      VN        0     0 |
123. |      VS        0     0 |
124. |      VX        0     0 |
125. |      WN        0     1 |
     |------------------------|
126. |      WP        0     0 |
127. |      WS        0     0 |
128. |      XE        0     0 |
129. |      YV        0     1 |
130. |      YX        0     1 |
     |------------------------|
131. |      YY        0     0 |
132. |      ZK        0     0 |
133. |      ZQ        0     0 |
134. |      ZV        0     0 |
135. |      ZW        0     0 |
     +------------------------+

. restore

. 
. 
end of do-file

. do /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T/StataRun1758140004618.do

. // Final project
. // Date : 9-15-2025
. // Reference for nested logit :
. //  - Train, Kenneth E. (2009). Discrete Choice Methods with Simulation, 2nd ed.
. //    Cambridge University Press — Chapter 4 “Nested Logit”.
. //  - Helpful note for share derivatives/elasticities:
. //     Mansley, R., N. Miller, C. Ryan, and M. Weinberg (2019/2024),
. //     “Notes on the Nested Logit Demand Model.” (short technical memo)
. 
. // Install as: 
. // net from http://www.bjornerstedt.org/stata/mergersim
. // net install mergersim, replace
. 
. *global mainpath "/Users/kkang57/Dropbox/Teaching/MS-IO/final_project"
. 
. cd "/Users/gisellelab/Work/airlines_merger_simulation"   // <-- adjust this, then run the do-file , My path is 
/Users/gisellelab/Work/airlines_merger_simulation

. 
. global PROC_DATA    "./data/processed/combined/"                // processed data

. global CODE_DIR      "./src/"                         

. global OUT      "./src/output/"              // output folder          // source code directory

. // global mainpath "/Users/karamkang/Library/CloudStorage/Dropbox/Teaching/MS-IO/final_project"
. 
. // log using "$mainpath/analysis/prelim_analysis.log", replace
. cap log using "${CODE_DIR}/logs/prelim_analysis_merger.log", replace

. 
. clear

. // use "$mainpath/data/airline_data_main.dta"
. use "$PROC_DATA/airline_data_main.dta", clear

. 
. *---------------------------
. * 1. preparing the data
. *---------------------------
. 
. // * Checking that legacy and lcc carriers have no overlap
. preserve

. bys carrier: keep if _n==1
(1,677,732 observations deleted)

. list carrier legacy lcc if !missing(legacy) | !missing(lcc)

     +------------------------+
     | carrier   legacy   lcc |
     |------------------------|
  1. |                0     0 |
  2. |      2F        0     0 |
  3. |      3E        0     0 |
  4. |      3M        0     0 |
  5. |      4B        0     0 |
     |------------------------|
  6. |      4M        0     0 |
  7. |      7H        0     0 |
  8. |      9E        0     0 |
  9. |      9K        0     0 |
 10. |      9L        0     0 |
     |------------------------|
 11. |      9W        0     0 |
 12. |      9X        0     0 |
 13. |      AA        1     0 |
 14. |      AB        0     0 |
 15. |      AC        0     0 |
     |------------------------|
 16. |      AF        0     0 |
 17. |      AL        0     0 |
 18. |      AM        0     0 |
 19. |      AQ        1     0 |
 20. |      AS        1     0 |
     |------------------------|
 21. |      AT        0     0 |
 22. |      AV        0     0 |
 23. |      AX        0     0 |
 24. |      AY        0     0 |
 25. |      AZ        0     0 |
     |------------------------|
 26. |      B6        0     1 |
 27. |      BA        0     0 |
 28. |      BB        0     0 |
 29. |      BD        0     0 |
 30. |      BR        0     0 |
     |------------------------|
 31. |      BW        0     0 |
 32. |      C5        0     0 |
 33. |      CA        0     0 |
 34. |      CI        0     0 |
 35. |      CL        0     0 |
     |------------------------|
 36. |      CM        0     0 |
 37. |      CO        1     0 |
 38. |      CX        0     0 |
 39. |      DH        0     1 |
 40. |      DL        1     0 |
     |------------------------|
 41. |      E9        0     0 |
 42. |      EI        0     0 |
 43. |      EK        0     0 |
 44. |      ET        0     0 |
 45. |      EV        0     0 |
     |------------------------|
 46. |      EY        0     0 |
 47. |      F8        0     0 |
 48. |      F9        0     1 |
 49. |      FI        0     0 |
 50. |      FJ        0     0 |
     |------------------------|
 51. |      FL        0     0 |
 52. |      G3        0     0 |
 53. |      G4        0     0 |
 54. |      G7        0     0 |
 55. |      GF        0     0 |
     |------------------------|
 56. |      GQ        0     0 |
 57. |      HA        1     0 |
 58. |      HP        0     0 |
 59. |      HQ        0     0 |
 60. |      HU        0     0 |
     |------------------------|
 61. |      IB        0     0 |
 62. |      JJ        0     0 |
 63. |      JK        0     0 |
 64. |      JL        0     0 |
 65. |      JM        0     0 |
     |------------------------|
 66. |      KE        0     0 |
 67. |      KL        0     0 |
 68. |      KS        0     0 |
 69. |      KX        0     0 |
 70. |      L4        0     0 |
     |------------------------|
 71. |      LA        0     0 |
 72. |      LH        0     0 |
 73. |      LO        0     0 |
 74. |      LP        0     0 |
 75. |      LW        0     0 |
     |------------------------|
 76. |      LX        0     0 |
 77. |      LY        0     0 |
 78. |      MA        0     0 |
 79. |      MH        0     0 |
 80. |      MQ        0     0 |
     |------------------------|
 81. |      MU        0     0 |
 82. |      MW        0     0 |
 83. |      MX        0     0 |
 84. |      NH        0     0 |
 85. |      NK        0     1 |
     |------------------------|
 86. |      NN        0     0 |
 87. |      NW        1     0 |
 88. |      NZ        0     0 |
 89. |      OH        0     0 |
 90. |      OK        0     0 |
     |------------------------|
 91. |      OO        0     0 |
 92. |      OS        0     0 |
 93. |      OZ        0     0 |
 94. |      PR        0     0 |
 95. |      QF        0     0 |
     |------------------------|
 96. |      QR        0     0 |
 97. |      QX        0     0 |
 98. |      RD        0     0 |
 99. |      RG        0     0 |
100. |      RJ        0     0 |
     |------------------------|
101. |      RP        0     0 |
102. |      RW        0     0 |
103. |      S5        0     0 |
104. |      SA        0     0 |
105. |      SK        0     0 |
     |------------------------|
106. |      SN        0     0 |
107. |      SQ        0     0 |
108. |      SU        0     0 |
109. |      SX        0     1 |
110. |      SY        0     1 |
     |------------------------|
111. |      TA        0     0 |
112. |      TK        0     0 |
113. |      TN        0     0 |
114. |      TP        0     0 |
115. |      TZ        0     1 |
     |------------------------|
116. |      U5        0     1 |
117. |      UA        1     0 |
118. |      UP        0     0 |
119. |      US        1     0 |
120. |      V2        0     0 |
     |------------------------|
121. |      VA        0     0 |
122. |      VN        0     0 |
123. |      VS        0     0 |
124. |      VX        0     0 |
125. |      WN        0     1 |
     |------------------------|
126. |      WP        0     0 |
127. |      WS        0     0 |
128. |      XE        0     0 |
129. |      YV        0     1 |
130. |      YX        0     1 |
     |------------------------|
131. |      YY        0     0 |
132. |      ZK        0     0 |
133. |      ZQ        0     0 |
134. |      ZV        0     0 |
135. |      ZW        0     0 |
     +------------------------+

. restore

. 
. 
. * focus on a 5% sub-sample of the data (for computational purposes)
. //! this way of randomizing is creating bias towards smaller markets (less observations per market)
. // set seed 12345
. // gen random_uniform = runiform()
. // bys market_code: egen rr = mean(random_uniform)
. // quietly sum rr, detail
. // keep if rr<r(p5)
. 
. // * new addition: sample 15% of markets, sample one market at a time
. preserve

. bys market_code: keep if _n == 1  // Keep one obs per market
(1,669,808 observations deleted)

. sample 15                          // Sample 15% of markets
(6,850 observations deleted)

. keep market_code                  // Keep only market identifier

. tempfile sampled_markets

. save `sampled_markets'
file /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T//S_17493.000003 saved as .dta format

. restore

. merge m:1 market_code using `sampled_markets', keep(match) nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           256,937  
    -----------------------------------------

. 
. * define markets: time-destination-origin
. encode carrier, gen(firmid)

. egen marketid = group(year quarter market_code)

. egen marketid2 = group(market_code)

. 
. * market size: alternatives
. gen pop_o_d_geo_mean = sqrt(origin_pop * dest_pop)      // geometric mean 
(6,393 missing values generated)

. gen pop_sum = origin_pop + dest_pop                     // sum
(6,393 missing values generated)

. gen mean_pop = (origin_pop + dest_pop)/2        // average
(6,393 missing values generated)

. gen max_pop = max(origin_pop, dest_pop)         // maximum
(2 missing values generated)

. 
. * declare market size
. gen msize = pop_o_d_geo_mean/10
(6,393 missing values generated)

. gen mshare = total_passengers/msize
(6,393 missing values generated)

. sum mshare

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mshare |    250,544    .0013442     .005388   7.18e-07   .2529275

. 
. * nesting groups: alternatives
. gen inside = 1

. gen nonstop_route = (share_nonstop > 0)  // by non stop vs. connecting

. 
. * declare nesting groups
. gen nest1 = inside // ! comment

. gen nest2 = 3 // ! comment

. replace nest2 = 1 if legacy == 1 // ! comment
(189,623 real changes made)

. replace nest2 = 2 if lcc == 1
(51,379 real changes made)

. 
. * market/product attributes
. gen dist_k   = average_distance/1000    // distances in thousands

. gen dist_k2  = dist_k^2                                 // distances in thousands, squared

. gen lnum_fringe = ln(1 + fringe_carriers)

. 
. * declare market/product attributes to control for
. local x_exog "share_nonstop dist_k dist_k2 lnum_fringe"

. 
. * instruments for market share
. bys marketid nest1 nest2: egen rival_carriers_nest = sum(inside)

. replace rival_carriers_nest = rival_carriers_nest-1 // number of rivals within the nest
(256,937 real changes made)

. 
. // * new addition: create additional IV for upper level nesting (rival carriers in market)
. * declare instruments for price and market share
. local inst "average_distance_rival average_num_destinations_rival rival_carriers_nest rival_carriers"

. 
. // * new addition: filter small market shares to avoid numerical issues (BEFORE mergersim init)
. scalar min_share_filter = 10^-7

. keep if mshare > min_share_filter
(0 observations deleted)

. 
. // * new addition: eliminate singleton markets after share filtering
. bys marketid: keep if _N > 1
(0 observations deleted)

. 
. * set the panel data: product x markets
. xtset firmid marketid

Panel variable: firmid (unbalanced)
 Time variable: marketid, 1 to 47432, but with gaps
         Delta: 1 unit

. 
. *-------------------------------------
. * 2. performing a merger simulation
. *-------------------------------------
. 
. * step 1: initializing the merger simulation settings
. mergersim init, nests(nest1 nest2) price(average_fare) quantity(total_passengers) marketsize(msize) firm(firmid)
--------------------------------------------------------------------------------
MERGERSIM: Merger Simulation Program
Version 1.0, Revision: 218 
--------------------------------------------------------------------------------
Unit demand two-level nested logit

                  Depvar              Price               Group shares
                  --------------------------------------------------------------
                  M_ls                average_fare        M_lsjh M_lshg
--------------------------------------------------------------------------------
Variables generated: M_ls M_lsjh M_lshg
--------------------------------------------------------------------------------

. 
. sum M_ls M_lsjh M_lshg // exploring that log nests are the same than in the demand estimation.do -----> YES

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        M_ls |    250,544   -8.063349    1.848713  -14.11493  -1.015037
      M_lsjh |    256,937   -1.930247    1.761466   -10.5602          0
      M_lshg |    256,937   -.7944398    1.143067  -10.99534          0

. 
. * step 2: nested logit demand model estimation
. ivreghdfe M_ls (average_fare M_lsjh M_lshg = average_distance_rival average_num_destinations_rival rival_carriers_nest rival_car
> riers_market) share_nonstop dist_k dist_k2 lnum_fringe, absorb(marketid2) cluster(marketid2)
variable rival_carriers_market not found
r(111);

end of do-file

r(111);

. do /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T/StataRun1758140137367.do

. // Final project
. // Date : 9-15-2025
. // Reference for nested logit :
. //  - Train, Kenneth E. (2009). Discrete Choice Methods with Simulation, 2nd ed.
. //    Cambridge University Press — Chapter 4 “Nested Logit”.
. //  - Helpful note for share derivatives/elasticities:
. //     Mansley, R., N. Miller, C. Ryan, and M. Weinberg (2019/2024),
. //     “Notes on the Nested Logit Demand Model.” (short technical memo)
. 
. // Install as: 
. // net from http://www.bjornerstedt.org/stata/mergersim
. // net install mergersim, replace
. 
. *global mainpath "/Users/kkang57/Dropbox/Teaching/MS-IO/final_project"
. 
. cd "/Users/gisellelab/Work/airlines_merger_simulation"   // <-- adjust this, then run the do-file , My path is 
/Users/gisellelab/Work/airlines_merger_simulation

. 
. global PROC_DATA    "./data/processed/combined/"                // processed data

. global CODE_DIR      "./src/"                         

. global OUT      "./src/output/"              // output folder          // source code directory

. // global mainpath "/Users/karamkang/Library/CloudStorage/Dropbox/Teaching/MS-IO/final_project"
. 
. // log using "$mainpath/analysis/prelim_analysis.log", replace
. cap log using "${CODE_DIR}/logs/prelim_analysis_merger.log", replace

. 
. clear

. // use "$mainpath/data/airline_data_main.dta"
. use "$PROC_DATA/airline_data_main.dta", clear

. 
. *---------------------------
. * 1. preparing the data
. *---------------------------
. 
. // * Checking that legacy and lcc carriers have no overlap
. preserve

. bys carrier: keep if _n==1
(1,677,732 observations deleted)

. list carrier legacy lcc if !missing(legacy) | !missing(lcc)

     +------------------------+
     | carrier   legacy   lcc |
     |------------------------|
  1. |                0     0 |
  2. |      2F        0     0 |
  3. |      3E        0     0 |
  4. |      3M        0     0 |
  5. |      4B        0     0 |
     |------------------------|
  6. |      4M        0     0 |
  7. |      7H        0     0 |
  8. |      9E        0     0 |
  9. |      9K        0     0 |
 10. |      9L        0     0 |
     |------------------------|
 11. |      9W        0     0 |
 12. |      9X        0     0 |
 13. |      AA        1     0 |
 14. |      AB        0     0 |
 15. |      AC        0     0 |
     |------------------------|
 16. |      AF        0     0 |
 17. |      AL        0     0 |
 18. |      AM        0     0 |
 19. |      AQ        1     0 |
 20. |      AS        1     0 |
     |------------------------|
 21. |      AT        0     0 |
 22. |      AV        0     0 |
 23. |      AX        0     0 |
 24. |      AY        0     0 |
 25. |      AZ        0     0 |
     |------------------------|
 26. |      B6        0     1 |
 27. |      BA        0     0 |
 28. |      BB        0     0 |
 29. |      BD        0     0 |
 30. |      BR        0     0 |
     |------------------------|
 31. |      BW        0     0 |
 32. |      C5        0     0 |
 33. |      CA        0     0 |
 34. |      CI        0     0 |
 35. |      CL        0     0 |
     |------------------------|
 36. |      CM        0     0 |
 37. |      CO        1     0 |
 38. |      CX        0     0 |
 39. |      DH        0     1 |
 40. |      DL        1     0 |
     |------------------------|
 41. |      E9        0     0 |
 42. |      EI        0     0 |
 43. |      EK        0     0 |
 44. |      ET        0     0 |
 45. |      EV        0     0 |
     |------------------------|
 46. |      EY        0     0 |
 47. |      F8        0     0 |
 48. |      F9        0     1 |
 49. |      FI        0     0 |
 50. |      FJ        0     0 |
     |------------------------|
 51. |      FL        0     0 |
 52. |      G3        0     0 |
 53. |      G4        0     0 |
 54. |      G7        0     0 |
 55. |      GF        0     0 |
     |------------------------|
 56. |      GQ        0     0 |
 57. |      HA        1     0 |
 58. |      HP        0     0 |
 59. |      HQ        0     0 |
 60. |      HU        0     0 |
     |------------------------|
 61. |      IB        0     0 |
 62. |      JJ        0     0 |
 63. |      JK        0     0 |
 64. |      JL        0     0 |
 65. |      JM        0     0 |
     |------------------------|
 66. |      KE        0     0 |
 67. |      KL        0     0 |
 68. |      KS        0     0 |
 69. |      KX        0     0 |
 70. |      L4        0     0 |
     |------------------------|
 71. |      LA        0     0 |
 72. |      LH        0     0 |
 73. |      LO        0     0 |
 74. |      LP        0     0 |
 75. |      LW        0     0 |
     |------------------------|
 76. |      LX        0     0 |
 77. |      LY        0     0 |
 78. |      MA        0     0 |
 79. |      MH        0     0 |
 80. |      MQ        0     0 |
     |------------------------|
 81. |      MU        0     0 |
 82. |      MW        0     0 |
 83. |      MX        0     0 |
 84. |      NH        0     0 |
 85. |      NK        0     1 |
     |------------------------|
 86. |      NN        0     0 |
 87. |      NW        1     0 |
 88. |      NZ        0     0 |
 89. |      OH        0     0 |
 90. |      OK        0     0 |
     |------------------------|
 91. |      OO        0     0 |
 92. |      OS        0     0 |
 93. |      OZ        0     0 |
 94. |      PR        0     0 |
 95. |      QF        0     0 |
     |------------------------|
 96. |      QR        0     0 |
 97. |      QX        0     0 |
 98. |      RD        0     0 |
 99. |      RG        0     0 |
100. |      RJ        0     0 |
     |------------------------|
101. |      RP        0     0 |
102. |      RW        0     0 |
103. |      S5        0     0 |
104. |      SA        0     0 |
105. |      SK        0     0 |
     |------------------------|
106. |      SN        0     0 |
107. |      SQ        0     0 |
108. |      SU        0     0 |
109. |      SX        0     1 |
110. |      SY        0     1 |
     |------------------------|
111. |      TA        0     0 |
112. |      TK        0     0 |
113. |      TN        0     0 |
114. |      TP        0     0 |
115. |      TZ        0     1 |
     |------------------------|
116. |      U5        0     1 |
117. |      UA        1     0 |
118. |      UP        0     0 |
119. |      US        1     0 |
120. |      V2        0     0 |
     |------------------------|
121. |      VA        0     0 |
122. |      VN        0     0 |
123. |      VS        0     0 |
124. |      VX        0     0 |
125. |      WN        0     1 |
     |------------------------|
126. |      WP        0     0 |
127. |      WS        0     0 |
128. |      XE        0     0 |
129. |      YV        0     1 |
130. |      YX        0     1 |
     |------------------------|
131. |      YY        0     0 |
132. |      ZK        0     0 |
133. |      ZQ        0     0 |
134. |      ZV        0     0 |
135. |      ZW        0     0 |
     +------------------------+

. restore

. 
. 
. * focus on a 5% sub-sample of the data (for computational purposes)
. //! this way of randomizing is creating bias towards smaller markets (less observations per market)
. // set seed 12345
. // gen random_uniform = runiform()
. // bys market_code: egen rr = mean(random_uniform)
. // quietly sum rr, detail
. // keep if rr<r(p5)
. 
. // * new addition: sample 15% of markets, sample one market at a time
. preserve

. bys market_code: keep if _n == 1  // Keep one obs per market
(1,669,808 observations deleted)

. sample 15                          // Sample 15% of markets
(6,850 observations deleted)

. keep market_code                  // Keep only market identifier

. tempfile sampled_markets

. save `sampled_markets'
file /var/folders/xb/mch0wfzd205d97392nxjwj240000gn/T//S_17493.000003 saved as .dta format

. restore

. merge m:1 market_code using `sampled_markets', keep(match) nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           252,814  
    -----------------------------------------

. 
. * define markets: time-destination-origin
. encode carrier, gen(firmid)

. egen marketid = group(year quarter market_code)

. egen marketid2 = group(market_code)

. 
. * market size: alternatives
. gen pop_o_d_geo_mean = sqrt(origin_pop * dest_pop)      // geometric mean 
(7,197 missing values generated)

. gen pop_sum = origin_pop + dest_pop                     // sum
(7,197 missing values generated)

. gen mean_pop = (origin_pop + dest_pop)/2        // average
(7,197 missing values generated)

. gen max_pop = max(origin_pop, dest_pop)         // maximum
(313 missing values generated)

. 
. * declare market size
. gen msize = pop_o_d_geo_mean/10
(7,197 missing values generated)

. gen mshare = total_passengers/msize
(7,197 missing values generated)

. sum mshare

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mshare |    245,617    .0015237    .0080223   6.12e-07   .4327434

. 
. * nesting groups: alternatives
. gen inside = 1

. gen nonstop_route = (share_nonstop > 0)  // by non stop vs. connecting

. 
. * declare nesting groups
. gen nest1 = inside // ! comment

. gen nest2 = 3 // ! comment

. replace nest2 = 1 if legacy == 1 // ! comment
(187,620 real changes made)

. replace nest2 = 2 if lcc == 1
(50,381 real changes made)

. 
. * market/product attributes
. gen dist_k   = average_distance/1000    // distances in thousands

. gen dist_k2  = dist_k^2                                 // distances in thousands, squared

. gen lnum_fringe = ln(1 + fringe_carriers)

. 
. * declare market/product attributes to control for
. local x_exog "share_nonstop dist_k dist_k2 lnum_fringe"

. 
. * instruments for market share
. bys marketid nest1 nest2: egen rival_carriers_nest = sum(inside)

. replace rival_carriers_nest = rival_carriers_nest-1 // number of rivals within the nest
(252,814 real changes made)

. 
. // * new addition: create additional IV for upper level nesting (rival carriers in market)
. * declare instruments for price and market share
. local inst "average_distance_rival average_num_destinations_rival rival_carriers_nest rival_carriers"

. 
. // * new addition: filter small market shares to avoid numerical issues (BEFORE mergersim init)
. scalar min_share_filter = 10^-7

. keep if mshare > min_share_filter
(0 observations deleted)

. 
. // * new addition: eliminate singleton markets after share filtering
. bys marketid: keep if _N > 1
(0 observations deleted)

. 
. * set the panel data: product x markets
. xtset firmid marketid

Panel variable: firmid (unbalanced)
 Time variable: marketid, 1 to 47204, but with gaps
         Delta: 1 unit

. 
. *-------------------------------------
. * 2. performing a merger simulation
. *-------------------------------------
. 
. * step 1: initializing the merger simulation settings
. mergersim init, nests(nest1 nest2) price(average_fare) quantity(total_passengers) marketsize(msize) firm(firmid)
--------------------------------------------------------------------------------
MERGERSIM: Merger Simulation Program
Version 1.0, Revision: 218 
--------------------------------------------------------------------------------
Unit demand two-level nested logit

                  Depvar              Price               Group shares
                  --------------------------------------------------------------
                  M_ls                average_fare        M_lsjh M_lshg
--------------------------------------------------------------------------------
Variables generated: M_ls M_lsjh M_lshg
--------------------------------------------------------------------------------

. 
. sum M_ls M_lsjh M_lshg // exploring that log nests are the same than in the demand estimation.do -----> YES

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        M_ls |    245,617   -8.030153    1.885549  -14.27474  -.1437373
      M_lsjh |    252,814   -1.970358    1.798146  -10.51632          0
      M_lshg |    252,814   -.7620893    1.122623  -11.09844          0

. 
. * step 2: nested logit demand model estimation
. ivreghdfe M_ls (average_fare M_lsjh M_lshg = `inst') `x_exog', absorb(marketid2) cluster(marketid2)
(MWFE estimator converged in 1 iterations)

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on marketid2

Number of clusters (marketid2) =   1168               Number of obs =   245617
                                                      F(  7,  1167) = 32592.69
                                                      Prob > F      =   0.0000
Total (centered) SS     =  776906.0857                Centered R2   =   0.9590
Total (uncentered) SS   =  776906.0857                Uncentered R2 =   0.9590
Residual SS             =  31872.47555                Root MSE      =    .3602

-------------------------------------------------------------------------------
              |               Robust
         M_ls | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
 average_fare |   -.003881    .000985    -3.94   0.000    -.0058136   -.0019484
       M_lsjh |   .9043708   .0169511    53.35   0.000     .8711128    .9376289
       M_lshg |   .9500896   .0298434    31.84   0.000     .8915369    1.008642
share_nonstop |   .2446047   .0375221     6.52   0.000     .1709863     .318223
       dist_k |  -.1975125   .1188193    -1.66   0.097    -.4306358    .0356108
      dist_k2 |   .0392463    .007675     5.11   0.000     .0241881    .0543046
  lnum_fringe |  -.0020058   .0146743    -0.14   0.891    -.0307967    .0267852
-------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):             49.011
                                                   Chi-sq(2) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):               95.202
                         (Kleibergen-Paap rk Wald F statistic):         14.186
Stock-Yogo weak ID test critical values:                       <not available>
------------------------------------------------------------------------------
Hansen J statistic (overidentification test of all instruments):        13.434
                                                   Chi-sq(1) P-val =    0.0002
------------------------------------------------------------------------------
Instrumented:         average_fare M_lsjh M_lshg
Included instruments: share_nonstop dist_k dist_k2 lnum_fringe
Excluded instruments: average_distance_rival average_num_destinations_rival
                      rival_carriers_nest rival_carriers
Partialled-out:       _cons
                      nb: total SS, model F and R2s are after partialling-out;
                          any small-sample adjustments include partialled-out
                          variables in regressor count K
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
   marketid2 |      1168        1168           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. * step 3: analyzing premerger market conditions
. mergersim market if year == 2013
---------------------------------------------------------------------------------
Supply: Bertrand competition
Demand: Unit demand two-level nested logit
--------------------------------------------------------------------------------
Demand estimate
ivreghdfe M_ls (average_fare M_lsjh M_lshg = average_distance_rival average_num_destinations_rival rival_carriers_nest rival_carri
> ers) share_nonstop dist_k dist_k2 lnum_fringe, absorb(marketid2) cluster(marketid2)
Dependent variable: M_ls
--------------------------------------------------------------------------------

Parameters

alpha = -0.004
sigma1 = 0.904 
sigma2 = 0.950 
----------------------------------------------------------------
Own- and Cross-Price Elasticities:  unweighted market averages

    Variable |      Mean        SD       Min       Max
-------------+----------------------------------------
       M_ejj |    -9.445     4.366   -82.957    -0.261
       M_ejk |     0.178     3.191   -24.365    17.176
       M_ejl |     3.351     4.009     0.000    34.568
       M_ejm |     0.001     0.004     0.000     0.136
------------------------------------------------------
Observations: 15653
----------------------------------------------------------------
ERROR: sigma 2 should be smaller than sigma 1.
sigma1: .9043708403256073
sigma2: .9500896245134167

Pre-merger Market Conditions 
Unweighted averages by firmid

---------------------------------------------------------------------------------
              firmid |       average_fare      Marginal costs   Pre-merger Lerner
---------------------+-----------------------------------------------------------
                  3M |             99.416              82.510               0.170
                  9K |            127.471                                        
                  AA |            246.955             218.232               0.123
                  AB |            428.288             406.238               0.099
                  AC |            103.491              78.878               0.238
                  AM |            384.396             359.870               0.064
                  AS |            292.593             255.364               0.177
                  AY |            353.441             329.019               0.090
                  B6 |            229.693             210.258               0.111
                  BA |            249.589             237.210               0.187
                  BB |             78.769                                        
                  CA |            129.364             104.767               0.190
                  CM |            475.358             462.482               0.027
                  CX |            694.343             671.214               0.033
                  DL |            247.318             210.966               0.151
                  EI |            458.319             433.692               0.054
                  F9 |            183.016             159.412               0.146
                  FL |            188.641             172.594               0.089
                  G4 |            100.036              29.864               0.749
                  HA |            296.134             229.618               0.445
                  IB |            254.609             229.977               0.113
                  JL |            352.517             327.892               0.071
                  LA |            218.995             194.359               0.112
                  LW |            136.932             120.028               0.123
                  LX |            205.135             180.500               0.120
                  NH |            406.111             387.371               0.132
                  NK |            123.375              85.688               0.275
                  NZ |           1340.151            1315.513               0.057
                  QF |            411.171             389.323               0.077
                  QR |            328.492             303.854               0.075
                  RJ |            104.877              80.268               0.235
                  SY |            207.613             173.377               0.162
                  UA |            250.901             220.817               0.126
                  US |            260.321             228.400               0.131
                  VA |           1101.443            1076.820               0.022
                  VS |             90.093              67.068               0.256
                  VX |            237.798             223.194               0.067
                  WN |            203.189             178.629               0.134
                  WP |            107.662              94.793               0.121
                  YV |             99.776              86.328               0.142
                  ZK |            216.038             203.177               0.060
---------------------------------------------------------------------------------
Variables generated: M_costs M_delta 
---------------------------------------------------------------------------------

. 
. * step 4: simulating the merger effects
. *         consider a merger between AA (buyer) and US (seller)
. *         note: AA and US merger approved in Dec 2013
. mergersim simulate if year == 2014, seller(61) buyer(6) detail
Simulation did not converge.
Error: 

---------------------------------------------------------------------------------
Merger Simulation

                                            Simulation method: Newton
                        Buyer     Seller    Periods/markets: 3087
Firm                    6         61        Average number of iterations: 33.68 
                                            Max number of iterations: 1000  
Marginal cost savings                       Max price change in last it: 3.3e-06  
---------------------------------------------------------------------------------

Prices
Unweighted averages by firmid

---------------------------------------------------------------------------------
              firmid |         Pre-merger         Post-merger     Relative change
---------------------+-----------------------------------------------------------
                  3M |            327.026             327.026               0.000
                  9K |            136.951             136.951               0.000
                  AA |            253.640             253.640              -0.000
                  AB |             85.251              85.251               0.000
                  AC |            912.977             912.977              -0.000
                  AF |             77.885              77.885              -0.000
                  AS |            288.000             288.000              -0.000
                  AY |            216.423             216.423              -0.000
                  B6 |            232.271             232.271              -0.000
                  BA |            356.810             356.810              -0.000
                  BB |             81.839              81.839               0.000
                  CM |            630.172             630.172               0.000
                  CX |            246.886             246.886               0.000
                  DL |            255.466             255.466              -0.000
                  EI |            554.924             554.924               0.000
                  EV |            170.501             170.501              -0.000
                  F9 |            178.505             178.505               0.000
                  FL |            185.714             185.714              -0.000
                  G4 |             98.405              98.405               0.000
                  HA |            338.481             338.481               0.000
                  IB |             94.659              94.659               0.000
                  JJ |            219.151             219.151              -0.000
                  JL |            593.799             593.799               0.000
                  LA |            188.688             188.688              -0.000
                  LH |            274.580             274.580              -0.000
                  LY |           1083.932            1083.932               0.000
                  NH |            210.967             210.967               0.000
                  NK |            124.236             124.236               0.000
                  NZ |            814.768             814.768              -0.000
                  OO |            528.444             528.444              -0.000
                  QF |            509.552             509.552              -0.000
                  QR |            326.449             326.449               0.000
                  SY |            231.120             231.120              -0.000
                  UA |            256.355             256.355              -0.000
                  US |            252.635             252.635               0.000
                  VS |            176.412             176.412               0.000
                  VX |            241.914             241.914               0.000
                  WN |            202.751             202.751               0.000
                  WP |             99.331              99.331              -0.000
                  YV |             91.564              91.564              -0.000
---------------------------------------------------------------------------------
Variables generated: M_price2 M_quantity2 M_price_ch (Other M_ variables dropped)
---------------------------------------------------------------------------------

Market shares by quantity
Unweighted averages by firmid

---------------------------------------------------------------------------------
              firmid |         Pre-merger         Post-merger          Difference
---------------------+-----------------------------------------------------------
                  3M |              0.000               0.000              -0.000
                  9K |              0.000               0.000               0.000
                  AA |              0.123               0.123              -0.000
                  AB |              0.000               0.000               0.000
                  AC |              0.000               0.000               0.000
                  AF |              0.000               0.000               0.000
                  AS |              0.193               0.193               0.000
                  AY |              0.000               0.000              -0.000
                  B6 |              0.085               0.085              -0.000
                  BA |              0.000               0.000              -0.000
                  BB |              0.000               0.000               0.000
                  CM |              0.000               0.000               0.000
                  CX |              0.000               0.000               0.000
                  DL |              0.263               0.263              -0.000
                  EI |              0.000               0.000               0.000
                  EV |              0.002               0.002              -0.000
                  F9 |              0.098               0.098               0.000
                  FL |              0.019               0.019              -0.000
                  G4 |              0.707               0.707               0.000
                  HA |              0.453               0.453              -0.000
                  IB |              0.000               0.000              -0.000
                  JJ |              0.000               0.000              -0.000
                  JL |              0.000               0.000               0.000
                  LA |              0.000               0.000               0.000
                  LH |              0.000               0.000               0.000
                  LY |              0.000               0.000              -0.000
                  NH |              0.000               0.000               0.000
                  NK |              0.104               0.104               0.000
                  NZ |              0.000               0.000               0.000
                  OO |              0.002               0.002              -0.000
                  QF |              0.000               0.000              -0.000
                  QR |              0.001               0.001               0.000
                  SY |              0.077               0.077               0.000
                  UA |              0.164               0.164              -0.000
                  US |              0.170               0.170              -0.000
                  VS |              0.000               0.000              -0.000
                  VX |              0.075               0.075               0.000
                  WN |              0.315               0.315               0.000
                  WP |              0.001               0.001              -0.000
                  YV |              0.032               0.032              -0.000
---------------------------------------------------------------------------------

--------------------------------------------------
                        Pre-merger     Post-merger
--------------------------------------------------
HHS:                     4326           4326
C4:                     93.84          93.84
C8:                     96.81          96.81
--------------------------------------------------
----------------------------------------
                                 Change
----------------------------------------
Consumer surplus:                    -0
Producer surplus:                    -0
----------------------------------------

. 
. log close
      name:  <unnamed>
       log:  /Users/gisellelab/Work/airlines_merger_simulation/src/logs/demand_estimation.log
  log type:  text
 closed on:  17 Sep 2025, 15:34:24
----------------------------------------------------------------------------------------------------------------------------------
